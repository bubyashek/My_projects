# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ Tetris

## –ü—Ä–∏–Ω—Ü–∏–ø—ã –¥–∏–∑–∞–π–Ω–∞

### ‚úÖ Single Source of Truth (–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã)

**–¶–≤–µ—Ç–∞**: –í—Å–µ —Ü–≤–µ—Ç–∞ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ** –≤ `theme.css` –∫–∞–∫ CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ. JavaScript —á–∏—Ç–∞–µ—Ç –∏—Ö —á–µ—Ä–µ–∑ `getComputedStyle()`.

```
theme.css (–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç)
    ‚Üì
    CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (--bg-canvas, --border-primary, etc.)
    ‚Üì
game.ts (—á–∏—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ getComputedStyle)
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
- ‚ùå **–î–æ**: –¶–≤–µ—Ç–∞ –±—ã–ª–∏ –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö (CSS + JS config)
- ‚úÖ **–°–µ–π—á–∞—Å**: –û–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã ‚Üí –ø—Ä–æ—â–µ –º–µ–Ω—è—Ç—å —Ç–µ–º—É
- üéØ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤ `theme.css` ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤–µ–∑–¥–µ

### üì¶ –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
src/
‚îú‚îÄ‚îÄ types.ts          # TypeScript –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚îú‚îÄ‚îÄ config.ts         # –ò–≥—Ä–æ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (—Ä–∞–∑–º–µ—Ä—ã, –æ—á–∫–∏, —Å–∫–æ—Ä–æ—Å—Ç—å)
‚îú‚îÄ‚îÄ tetrominos.ts     # –§–∏–≥—É—Ä—ã –∏ —Ü–≤–µ—Ç–∞ —Ç–µ—Ç—Ä–∞–º–∏–Ω–æ
‚îú‚îÄ‚îÄ leaderboard.ts    # –õ–æ–≥–∏–∫–∞ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
‚îú‚îÄ‚îÄ game.ts           # –û—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
‚îî‚îÄ‚îÄ main.ts           # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
```

## –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### üé® –ü–æ—Ç–æ–∫ —Ü–≤–µ—Ç–æ–≤

```
1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤ theme.css:
   :root {
       --bg-canvas: #ffffff;
   }

2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ styles.css:
   #gameCanvas {
       background: var(--bg-canvas);
   }

3. –ß—Ç–µ–Ω–∏–µ –≤ game.ts:
   getCanvasBackground(): string {
       return getComputedStyle(document.documentElement)
           .getPropertyValue('--bg-canvas').trim();
   }

4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
   this.ctx.fillStyle = this.getCanvasBackground();
```

### üéÆ –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª

```
main.ts
  ‚Üì
TetrisGame.constructor()
  ‚Üì
start() ‚Üí startGameLoop()
  ‚Üì
setInterval() –∫–∞–∂–¥—ã–µ N –º—Å
  ‚Üì
moveDown()
  ‚Üì
render() ‚Üí drawGrid() + drawBlock()
  ‚Üì
Canvas API —Ä–∏—Å—É–µ—Ç –Ω–∞ —ç–∫—Ä–∞–Ω–µ
```

### üèÜ –ü–æ—Ç–æ–∫ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞

```
Game Over
  ‚Üì
TetrisGame.handleGameOver()
  ‚Üì
leaderboard.addEntry(name, score, level)
  ‚Üì
–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏—á–Ω–æ–≥–æ —Ä–µ–∫–æ—Ä–¥–∞
  ‚Üì
localStorage.setItem('tetris-leaderboard', JSON)
  ‚Üì
window.updateLeaderboardDisplay()
  ‚Üì
renderLeaderboard() –æ–±–Ω–æ–≤–ª—è–µ—Ç DOM
```

## –ö–ª—é—á–µ–≤—ã–µ –∫–ª–∞—Å—Å—ã

### `TetrisGame` (game.ts)

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**: –û—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
- `start()` - –∑–∞–ø—É—Å–∫–∞–µ—Ç –∏–≥—Ä—É
- `moveDown()`, `moveLeft()`, `moveRight()` - –¥–≤–∏–∂–µ–Ω–∏–µ
- `rotate()` - –ø–æ–≤–æ—Ä–æ—Ç —Ñ–∏–≥—É—Ä—ã
- `isValidMove()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–∏–∑–∏–π
- `lockPiece()` - —Ñ–∏–∫—Å–∞—Ü–∏—è —Ñ–∏–≥—É—Ä—ã
- `clearLines()` - —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –ª–∏–Ω–∏–π
- `render()` - –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è

**–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö:**
- `GAME_CONFIG` - –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏–≥—Ä—ã
- CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ - —Ü–≤–µ—Ç–∞ (—á–µ—Ä–µ–∑ `getComputedStyle`)
- `TETROMINOS` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ–∏–≥—É—Ä

### `Leaderboard` (leaderboard.ts)

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü–µ–π —Ä–µ–∫–æ—Ä–¥–æ–≤

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
- `addEntry()` - –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ª–∏—á–Ω—ã–π —Ä–µ–∫–æ—Ä–¥)
- `getEntries()` - –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–ø-10
- `getPlayerBest()` - –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–≥—Ä–æ–∫–∞
- `load()` / `save()` - —Ä–∞–±–æ—Ç–∞ —Å localStorage

**–õ–æ–≥–∏–∫–∞ —É–º–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:**
```typescript
if (existingBest && existingBest.score >= score) {
    return false; // –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ö—É–¥—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
}
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è vs –¢–µ–º–∞

### `config.ts` - –ò–≥—Ä–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞
- ‚úÖ –†–∞–∑–º–µ—Ä—ã –ø–æ–ª—è (ROWS, COLS, BLOCK_SIZE)
- ‚úÖ –°–∫–æ—Ä–æ—Å—Ç—å –∏–≥—Ä—ã (INITIAL_DROP_SPEED, MIN_DROP_SPEED)
- ‚úÖ –û—á–∫–∏ –∑–∞ –ª–∏–Ω–∏–∏ (POINTS)
- ‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å–∏—è —É—Ä–æ–≤–Ω–µ–π (LINES_PER_LEVEL)

### `theme.css` - –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ
- ‚úÖ –í—Å–µ —Ü–≤–µ—Ç–∞ (—Ñ–æ–Ω—ã, –≥—Ä–∞–Ω–∏—Ü—ã, —Ç–µ–∫—Å—Ç)
- ‚úÖ –¢–µ–Ω–∏ –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏
- ‚úÖ –¶–≤–µ—Ç–∞ —Ç–µ—Ç—Ä–∞–º–∏–Ω–æ (–¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤ `tetrominos.ts`)

### `tetrominos.ts` - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ–∏–≥—É—Ä
- ‚úÖ –§–æ—Ä–º—ã —Ç–µ—Ç—Ä–∞–º–∏–Ω–æ (–º–∞—Å—Å–∏–≤—ã 0 –∏ 1)
- ‚úÖ –¶–≤–µ—Ç–∞ —Ç–µ—Ç—Ä–∞–º–∏–Ω–æ (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å `theme.css`)

## –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. **Module Pattern** (ES6 –º–æ–¥—É–ª–∏)
–ö–∞–∂–¥—ã–π —Ñ–∞–π–ª —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
```typescript
export class TetrisGame { ... }
export const GAME_CONFIG = { ... }
```

### 2. **Single Responsibility Principle**
- `game.ts` - —Ç–æ–ª—å–∫–æ –∏–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
- `leaderboard.ts` - —Ç–æ–ª—å–∫–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∫–æ—Ä–¥–∞–º–∏
- `tetrominos.ts` - —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ–∏–≥—É—Ä

### 3. **Dependency Injection**
```typescript
constructor(canvasId: string, nextCanvasId: string, username: string) {
    this.canvas = document.getElementById(canvasId);
    // ...
}
```

### 4. **CSS Variables + JS Integration**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `getComputedStyle()` –¥–ª—è —á—Ç–µ–Ω–∏—è CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:
```typescript
private getCanvasBackground(): string {
    return getComputedStyle(document.documentElement)
        .getPropertyValue('--bg-canvas').trim() || '#ffffff';
}
```

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–≤ TetrisGame)
- `board` - –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ (2D –º–∞—Å—Å–∏–≤)
- `currentPiece` - —Ç–µ–∫—É—â–∞—è –ø–∞–¥–∞—é—â–∞—è —Ñ–∏–≥—É—Ä–∞
- `nextPiece` - —Å–ª–µ–¥—É—é—â–∞—è —Ñ–∏–≥—É—Ä–∞
- `score`, `level`, `linesCleared` - –∏–≥—Ä–æ–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å
- `gameOver`, `isPaused` - —Ñ–ª–∞–≥–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (localStorage)
- `tetris-username` - –∏–º—è –∏–≥—Ä–æ–∫–∞
- `tetris-leaderboard` - —Ç–æ–ø-10 —Ä–µ–∫–æ—Ä–¥–æ–≤ (JSON)

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ DOM —ç–ª–µ–º–µ–Ω—Ç–æ–≤** –≤ constructor
2. **requestAnimationFrame –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** - –∏—Å–ø–æ–ª—å–∑—É–µ–º `setInterval` –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏
3. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏** - —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
4. **Lazy Loading** - CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —á–∏—Ç–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–µ

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `requestAnimationFrame` –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Web Workers –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é –¥–ª—è –¥–ª–∏–Ω–Ω–æ–≥–æ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ß—Ç–æ –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
- ‚úÖ `isValidMove()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–∏–∑–∏–π
- ‚úÖ `clearLines()` - –ø–æ–¥—Å—á–µ—Ç –æ—á–∫–æ–≤
- ‚úÖ `rotateTetromino()` - –ø–æ–≤–æ—Ä–æ—Ç —Ñ–∏–≥—É—Ä
- ‚úÖ `leaderboard.addEntry()` - –ª–æ–≥–∏–∫–∞ –ª–∏—á–Ω—ã—Ö —Ä–µ–∫–æ—Ä–¥–æ–≤

### –ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞ (–ø—Å–µ–≤–¥–æ–∫–æ–¥)
```typescript
test('should not add score worse than personal best', () => {
    leaderboard.addEntry('Player1', 1000, 5);
    const result = leaderboard.addEntry('Player1', 500, 3);
    expect(result).toBe(false);
    expect(leaderboard.getPlayerBest('Player1').score).toBe(1000);
});
```

## –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å

### –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ç–µ–º—É
1. –ò–∑–º–µ–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `theme.css`
2. ‚úÖ –ì–æ—Ç–æ–≤–æ! JavaScript –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç –Ω–æ–≤—ã–µ —Ü–≤–µ—Ç–∞

### –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ñ–∏–≥—É—Ä—É
1. –î–æ–±–∞–≤—å—Ç–µ —Ç–∏–ø –≤ `types.ts`
2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ñ–æ—Ä–º—É –∏ —Ü–≤–µ—Ç –≤ `tetrominos.ts`
3. –î–æ–±–∞–≤—å—Ç–µ CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≤ `theme.css` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –∏–≥—Ä–æ–≤—É—é –º–µ—Ö–∞–Ω–∏–∫—É
1. –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ `config.ts`
2. –û–±–Ω–æ–≤–∏—Ç–µ –ª–æ–≥–∏–∫—É –≤ `game.ts` (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
3. ‚úÖ –¢–µ–º–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–π

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### Runtime
- –ù–µ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π! üéâ
- –¢–æ–ª—å–∫–æ –Ω–∞—Ç–∏–≤–Ω—ã–µ Web APIs:
  - Canvas API (—Ä–∏—Å–æ–≤–∞–Ω–∏–µ)
  - localStorage API (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ)
  - DOM API (–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ)

### Development
- TypeScript (^5.2.2) - –∫–æ–º–ø–∏–ª—è—Ü–∏—è
- Node.js + npm - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–∞–º–∏
- Python 3 (http.server) - –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä

## –î–∏–∞–≥—Ä–∞–º–º–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```
theme.css (CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ)
    ‚Üì
styles.css (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ)
    ‚Üì
HTML (–ø–æ–¥–∫–ª—é—á–∞–µ—Ç —Å—Ç–∏–ª–∏)
    ‚Üì
main.ts (—Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞)
    ‚Üì
game.ts (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å–µ)
    ‚îú‚îÄ‚îÄ types.ts
    ‚îú‚îÄ‚îÄ config.ts (—Ç–æ–ª—å–∫–æ –º–µ—Ö–∞–Ω–∏–∫–∞!)
    ‚îú‚îÄ‚îÄ tetrominos.ts
    ‚îî‚îÄ‚îÄ leaderboard.ts

getComputedStyle() - –º–æ—Å—Ç –º–µ–∂–¥—É CSS –∏ JS
```

---

**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: 5 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è**: 1.8


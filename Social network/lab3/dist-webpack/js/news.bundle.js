(()=>{"use strict";var e,n={140:()=>{var e=function(e,n,t,o){return new(t||(t=Promise))(function(i,s){function a(e){try{r(o.next(e))}catch(e){s(e)}}function d(e){try{r(o.throw(e))}catch(e){s(e)}}function r(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(a,d)}r((o=o.apply(e,n||[])).next())})};const n="/api";function t(n,t){return e(this,void 0,void 0,function*(){try{const e=yield fetch(n,Object.assign(Object.assign({},t),{headers:Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers)}));if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return yield e.json()}catch(e){throw console.error("Fetch error:",e),e}})}const o=()=>t(`${n}/users`),i=e=>t(`${n}/users/${e}`),s=e=>t(`${n}/users/${e}/friends-news`),a=e=>t(`${n}/news`,{method:"POST",body:JSON.stringify(e)}),d=(e,o)=>t(`${n}/news/${e}`,{method:"PUT",body:JSON.stringify({status:o})}),r=e=>t(`${n}/news/${e}`,{method:"DELETE"}),c=(e,n="success")=>{const t="error"===n?"danger":n,o=document.createElement("div");o.className=`alert alert-${t} alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3`,o.style.zIndex="9999",o.innerHTML=`\n    ${e}\n    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n  `,document.body.appendChild(o),setTimeout(()=>{o.remove()},3e3)},l=e=>{const n=[e.lastName,e.firstName];return e.middleName&&n.push(e.middleName),n.join(" ")};let u,m=null;const v=e=>new Promise(n=>{(()=>{var e,n,t;if(u)return;document.getElementById("confirmModal")||document.body.insertAdjacentHTML("beforeend",'\n    <div class="modal fade" id="confirmModal" tabindex="-1">\n      <div class="modal-dialog modal-dialog-centered">\n        <div class="modal-content confirm-modal-content">\n          <div class="modal-header confirm-modal-header">\n            <h5 class="modal-title">\n              <i class="fas fa-exclamation-triangle me-2"></i>\n              Подтверждение действия\n            </h5>\n          </div>\n          <div class="modal-body confirm-modal-body">\n            <p id="confirmModalMessage"></p>\n          </div>\n          <div class="modal-footer confirm-modal-footer">\n            <button type="button" class="btn btn-secondary" id="confirmModalCancel">\n              <i class="fas fa-times me-2"></i>\n              Отмена\n            </button>\n            <button type="button" class="btn btn-danger" id="confirmModalConfirm">\n              <i class="fas fa-check me-2"></i>\n              Подтвердить\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  '),void 0!==window.bootstrap&&(u=new window.bootstrap.Modal(document.getElementById("confirmModal"))),null===(e=document.getElementById("confirmModalCancel"))||void 0===e||e.addEventListener("click",()=>{null==u||u.hide(),m&&(m(!1),m=null)}),null===(n=document.getElementById("confirmModalConfirm"))||void 0===n||n.addEventListener("click",()=>{null==u||u.hide(),m&&(m(!0),m=null)}),null===(t=document.getElementById("confirmModal"))||void 0===t||t.addEventListener("hidden.bs.modal",()=>{m&&(m(!1),m=null)})})();const t=document.getElementById("confirmModalMessage");t&&(t.textContent=e),m=n,null==u||u.show()});var w=function(e,n,t,o){return new(t||(t=Promise))(function(i,s){function a(e){try{r(o.next(e))}catch(e){s(e)}}function d(e){try{r(o.throw(e))}catch(e){s(e)}}function r(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(a,d)}r((o=o.apply(e,n||[])).next())})};let f,h,y=[],g="all",b=[];const p=()=>w(void 0,void 0,void 0,function*(){try{const e=window.location.pathname.split("/");if(f=parseInt(e[e.length-1]),isNaN(f))return void c("Неверный ID пользователя","error");yield I(),yield N(),yield $(),h=new bootstrap.Modal(document.getElementById("addNewsModal")),O(),x()}catch(e){console.error("Initialization error:",e),c("Ошибка инициализации страницы","error")}}),$=()=>w(void 0,void 0,void 0,function*(){try{b=yield o(),E()}catch(e){console.error("Error loading users:",e)}}),E=()=>{const e=document.getElementById("addNewsUser");if(!e)return;e.innerHTML='<option value="" disabled selected>Выберите пользователя...</option>';const n=b.find(e=>e.id===f);n&&(e.innerHTML+=`<option value="${n.id}" selected>${l(n)} (текущий)</option>`),b.filter(e=>e.id!==f).forEach(n=>{e.innerHTML+=`<option value="${n.id}">${l(n)}</option>`})},I=()=>w(void 0,void 0,void 0,function*(){try{const e=yield i(f),n=document.getElementById("user-name");n&&(n.textContent=`Новости друзей пользователя: ${l(e)}`)}catch(e){console.error("Error loading user:",e)}}),N=()=>w(void 0,void 0,void 0,function*(){const e=document.getElementById("news-container");if(e)try{const e=yield s(f),n=yield o();y=e.map(e=>Object.assign(Object.assign({},e),{author:n.find(n=>n.id===e.userId)})),k()}catch(n){console.error("Error loading news:",n),e.innerHTML='<div class="alert alert-danger">Ошибка загрузки новостей</div>'}}),k=()=>{const e=document.getElementById("news-container");if(!e)return;const n=y.filter(e=>"all"===g||e.status===g).sort((e,n)=>new Date(n.createdAt).getTime()-new Date(e.createdAt).getTime());0!==n.length?e.innerHTML=n.map(e=>{return`\n    <div class="news-card" data-news-id="${e.id}" data-status="${e.status}">\n      <div class="news-header">\n        <div class="news-author">\n          ${e.author?`\n            <img src="${e.author.photo}" alt="${l(e.author)}" class="news-author-avatar">\n            <div class="author-info">\n              <div class="author-name">${l(e.author)}</div>\n              <div class="news-date">${n=e.createdAt,new Date(n).toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}</div>\n            </div>\n          `:"<div>Автор неизвестен</div>"}\n        </div>\n        <div class="news-status-controls">\n          <span class="badge-status ${e.status}">${"active"===e.status?"Активна":"Заблокирована"}</span>\n        </div>\n      </div>\n      <h3 class="news-title">${e.title}</h3>\n      ${e.image?`<div class="news-image"><img src="${e.image}" alt="${e.title}"></div>`:""}\n      <p class="news-content">${e.content}</p>\n      <div class="news-actions">\n        <button class="btn btn-sm ${"active"===e.status?"btn-warning":"btn-success"}" \n                onclick="toggleNewsStatus(${e.id}, '${"active"===e.status?"blocked":"active"}')">\n          <i class="fas fa-${"active"===e.status?"ban":"check"}"></i>\n          ${"active"===e.status?"Заблокировать":"Активировать"}\n        </button>\n        <button class="btn btn-sm btn-danger" onclick="deleteNews(${e.id})">\n          <i class="fas fa-trash-alt"></i>\n          Удалить\n        </button>\n      </div>\n    </div>\n  `;var n}).join(""):e.innerHTML='<div class="alert alert-info">Новостей не найдено</div>'},M=(e,n)=>w(void 0,void 0,void 0,function*(){const t="blocked"===n?"заблокировать":"активировать";if(yield v(`Вы уверены, что хотите ${t} эту новость?`))try{yield d(e,n),c("Новость успешно "+("blocked"===n?"заблокирована":"активирована"),"success"),yield N()}catch(e){console.error("Error updating news status:",e),c("Ошибка изменения статуса новости","error")}}),B=()=>{const e=document.getElementById("filterNewsStatus");e&&(g=e.value,k())},O=()=>{const e=document.getElementById("addNewsForm");e&&e.addEventListener("submit",e=>w(void 0,void 0,void 0,function*(){e.preventDefault(),yield T()}))},T=()=>w(void 0,void 0,void 0,function*(){const e=parseInt(document.getElementById("addNewsUser").value),n=document.getElementById("addNewsTitle").value,t=document.getElementById("addNewsContent").value,o=document.getElementById("addNewsImage").value,i=document.getElementById("addNewsStatus").value;try{const s={userId:e,title:n,content:t,status:i,createdAt:(new Date).toISOString()};o&&""!==o.trim()&&(s.image=o),yield a(s),c("Новость успешно создана","success"),h.hide(),document.getElementById("addNewsForm").reset(),E(),yield N()}catch(e){console.error("Error creating news:",e),c("Ошибка создания новости","error")}}),L=e=>w(void 0,void 0,void 0,function*(){if(yield v("Вы уверены, что хотите удалить эту новость?"))try{yield r(e),c("Новость успешно удалена","success"),yield N()}catch(e){console.error("Error deleting news:",e),c("Ошибка удаления новости","error")}}),x=()=>{window.toggleNewsStatus=M,window.filterNews=B,window.deleteNews=L,window.goBackToUsers=()=>{const e=window.location.pathname.includes("webpack");window.location.href=e?"/webpack-users":"/users"},window.viewFriends=e=>{const n=window.location.pathname.includes("webpack");window.location.href=n?`/webpack-friends/${e}`:`/friends/${e}`},window.viewNews=e=>{const n=window.location.pathname.includes("webpack");window.location.href=n?`/webpack-news/${e}`:`/news/${e}`}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",p):p()}},t={};function o(e){var i=t[e];if(void 0!==i)return i.exports;var s=t[e]={exports:{}};return n[e](s,s.exports,o),s.exports}o.m=n,e=[],o.O=(n,t,i,s)=>{if(!t){var a=1/0;for(l=0;l<e.length;l++){for(var[t,i,s]=e[l],d=!0,r=0;r<t.length;r++)(!1&s||a>=s)&&Object.keys(o.O).every(e=>o.O[e](t[r]))?t.splice(r--,1):(d=!1,s<a&&(a=s));if(d){e.splice(l--,1);var c=i();void 0!==c&&(n=c)}}return n}s=s||0;for(var l=e.length;l>0&&e[l-1][2]>s;l--)e[l]=e[l-1];e[l]=[t,i,s]},o.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),(()=>{var e={946:0,177:0};o.O.j=n=>0===e[n];var n=(n,t)=>{var i,s,[a,d,r]=t,c=0;if(a.some(n=>0!==e[n])){for(i in d)o.o(d,i)&&(o.m[i]=d[i]);if(r)var l=r(o)}for(n&&n(t);c<a.length;c++)s=a[c],o.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return o.O(l)},t=self.webpackChunksocial_network_lab3_etu_2=self.webpackChunksocial_network_lab3_etu_2||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))})();var i=o.O(void 0,[177],()=>o(140));i=o.O(i)})();
//# sourceMappingURL=news.bundle.js.map